<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.huayu.dao.mapper.ProjectAttenderMapper">
	<resultMap id="projectResultMap" type="com.huayu.bo.ProjectAttender">
	<!-- 
	  WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jun 11 22:29:24 CST 2015.
    -->

		<id column="id" property="id" jdbcType="BIGINT" />
		<result column="project_id" property="projectId" jdbcType="BIGINT" />
		<result column="attender_id" property="attenderId" jdbcType="BIGINT" />
		<result column="apply_date" property="applyDate"  />
		<result column="role" property="role" jdbcType="TINYINT" />
		<result column="state" property="state" jdbcType="TINYINT" />
		<result column="msg" property="msg" jdbcType="VARCHAR" />
		
		<result column="hym" property="attenderName" jdbcType="VARCHAR" />
		<result column="nic" property="attenderPetName" jdbcType="VARCHAR" />
		
		<result column="portraitSrc" property="portraitSrc" jdbcType="VARCHAR" />
			
	
	</resultMap>
	
	<sql id="comCondition">
		<where>
			<if test="id != null">
		 	and pa.id = #{id} 
		</if>
       		<if test="projectId != null">
		 	and pa.project_id= #{projectId} 
		</if>
       		<if test="attenderId != null">
		 	and pa.attender_id = #{attenderId} 
		</if>
       		<if test="applyDate != null">
		 	and pa.apply_date = #{applyDate} 
		</if>
       		<if test="role != null">
		 	and pa.role = #{role} 
		</if>
       		<if test="state != null">
		 	and pa.state = #{state} 
		</if>
		</where>
	</sql>
	<select id="selectProjectAttenders" resultMap="projectResultMap">
		select p.id, project_id, attender_id, apply_date, p.role, state , msg , u.yhm , u.nic
		, u.yhtp portraitSrc
		from tb_project_attender p left join tb_user u on p.attender_id = u.id
		
	</select>
	
	<select id="selectProjects"  resultMap="projectResultMap">
		SELECT COUNT(*) attender_count, p.id, project_id, attender_id, apply_date, role, state , r.`resName` , r.`uploadDate`, r.`pState`, r.`resPath` , r.`resSrc`
		FROM tb_project_attender p LEFT JOIN tb_resources r ON p.res_id = r.id
		<where>
		<if test="id != null">
		 	and id = #{id} 
		</if>
       		<if test="resId != null">
		 	and res_id = #{resId} 
		</if>
       		<if test="attenderId != null">
		 	and attender_id = #{attenderId} 
		</if>
       		<if test="applyDate != null">
		 	and apply_date = #{applyDate} 
		</if>
       		<if test="role != null">
		 	and role = #{role} 
		</if>
       		<if test="state != null">
		 	and state = #{state} 
		</if>
		</where>
		GROUP BY p.`res_id`
		<if test="orderBy != null">
	    	order by #{orderBy}
	    </if>
		<if test="beginNum != null and offset != null">
		    limit #{beginNum} , #{offset}
	    </if>
	</select>
	
	<select id="selectProjectsSub"  resultMap="projectResultMap">
		SELECT COUNT(*) attender_count, p.id, res_id, attender_id, apply_date, role, state , r.`resName` , r.`uploadDate`, r.`pState`, r.`resPath` , r.`resSrc`
		FROM tb_project p LEFT JOIN tb_resources r ON p.res_id = r.id
		where res_id in (
			select res_id 
			FROM tb_project
		<where>
			<if test="id != null">
		 	and id = #{id} 
		</if>
       		<if test="resId != null">
		 	and res_id = #{resId} 
		</if>
       		<if test="attenderId != null">
		 	and attender_id = #{attenderId} 
		</if>
       		<if test="applyDate != null">
		 	and apply_date = #{applyDate} 
		</if>
       		<if test="role != null">
		 	and role = #{role} 
		</if>
       		<if test="state != null">
		 	and state = #{state} 
		</if>
		</where>
		)		
		GROUP BY p.`res_id`
		<if test="orderBy != null">
	    	order by #{orderBy}
	    </if>
		<if test="beginNum != null and offset != null">
		    limit #{beginNum} , #{offset}
	    </if>
	</select>
	
	
	<select id="selectProjectsCount" resultType="java.lang.Long" > 
		SELECT COUNT(DISTINCT(res_id)) 
		FROM tb_project p LEFT JOIN tb_resources r ON p.res_id = r.id 
		<where>
       		<if test="attenderId != null">
			 	and attender_id = #{attenderId} 
			</if>
       		<if test="applyDate != null">
				and apply_date = #{applyDate} 
			</if>
       		<if test="role != null">
			 	and role = #{role} 
			</if>
       		<if test="state != null">
			 	and state = #{state} 
			</if>
		</where>
	</select>
</mapper>